<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>nanobot</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #0d1117; color: #c9d1d9; height: 100vh; display: flex; flex-direction: column;
  }
  #header {
    padding: 12px 20px; background: #161b22; border-bottom: 1px solid #30363d;
    display: flex; align-items: center; gap: 10px;
  }
  #header h1 { font-size: 16px; font-weight: 600; }
  #status { font-size: 12px; color: #8b949e; }
  #status.connected { color: #3fb950; }
  #messages {
    flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px;
  }
  .msg {
    max-width: 80%; padding: 10px 14px; border-radius: 12px; line-height: 1.5;
    white-space: pre-wrap; word-wrap: break-word; font-size: 14px;
  }
  .msg.user { align-self: flex-end; background: #1f6feb; color: #fff; border-bottom-right-radius: 4px; }
  .msg.assistant { align-self: flex-start; background: #21262d; border: 1px solid #30363d; border-bottom-left-radius: 4px; }
  .msg.typing { opacity: 0.6; font-style: italic; }
  #input-area {
    padding: 12px 20px; background: #161b22; border-top: 1px solid #30363d;
    display: flex; gap: 10px;
  }
  #input {
    flex: 1; padding: 10px 14px; background: #0d1117; border: 1px solid #30363d;
    border-radius: 8px; color: #c9d1d9; font-size: 14px; outline: none; resize: none;
    font-family: inherit;
  }
  #input:focus { border-color: #1f6feb; }
  #send {
    padding: 10px 20px; background: #1f6feb; color: #fff; border: none;
    border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;
  }
  #send:hover { background: #388bfd; }
  #send:disabled { opacity: 0.5; cursor: not-allowed; }
</style>
</head>
<body>
<div id="header">
  <h1>nanobot</h1>
  <span id="status">disconnected</span>
</div>
<div id="messages"></div>
<div id="input-area">
  <textarea id="input" rows="1" placeholder="Type a message..." autocomplete="off"></textarea>
  <button id="send">Send</button>
</div>
<script>
(function() {
  const msgs = document.getElementById('messages');
  const input = document.getElementById('input');
  const sendBtn = document.getElementById('send');
  const status = document.getElementById('status');
  let ws, reconnectTimer;

  function connect() {
    const proto = location.protocol === 'https:' ? 'wss:' : 'ws:';
    ws = new WebSocket(`${proto}//${location.host}/ws`);
    ws.onopen = () => { status.textContent = 'connected'; status.className = 'connected'; };
    ws.onclose = () => {
      status.textContent = 'disconnected'; status.className = '';
      reconnectTimer = setTimeout(connect, 3000);
    };
    ws.onmessage = (e) => {
      try {
        const data = JSON.parse(e.data);
        // Remove typing indicator
        const typing = msgs.querySelector('.typing');
        if (typing) typing.remove();
        if (data.content) addMsg('assistant', data.content);
      } catch(err) { addMsg('assistant', e.data); }
    };
  }

  function addMsg(role, text) {
    const el = document.createElement('div');
    el.className = `msg ${role}`;
    el.textContent = text;
    msgs.appendChild(el);
    msgs.scrollTop = msgs.scrollHeight;
  }

  function addTyping() {
    const el = document.createElement('div');
    el.className = 'msg assistant typing';
    el.textContent = 'Thinking...';
    msgs.appendChild(el);
    msgs.scrollTop = msgs.scrollHeight;
  }

  function send() {
    const text = input.value.trim();
    if (!text || !ws || ws.readyState !== 1) return;
    addMsg('user', text);
    ws.send(JSON.stringify({ message: text }));
    input.value = '';
    input.style.height = 'auto';
    addTyping();
  }

  sendBtn.onclick = send;
  input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); }
  });
  input.addEventListener('input', () => {
    input.style.height = 'auto';
    input.style.height = Math.min(input.scrollHeight, 120) + 'px';
  });

  connect();
})();
</script>
</body>
</html>
